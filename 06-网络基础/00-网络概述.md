## 一  网络概念

### 1.1 因特网与端系统

> **因特网**：世界范围的计算机网络，互联了全世界亿级数量的网络设备。

这些设备可以是：传统PC、Linux工作站、移动设备、安全系统等等，他们统称为**主机(host)/端系统(end system)**。

### 1.2 端系统的连接

> **分组**（packet）：一台端系统向另一台端系统发送时，发送端系统将数据分段，为每段都加上首部字节，形成的数据包称为分组。

端系统之间如果要连接（发送与接收数据），需要两个因素：
- **通信链路**（communication link）：负责传输数据，一般是类似光纤、无线电频谱这样的物理媒体。
  - 传输速度单位为：比特/秒（bit/s，或bps）
- **分组交换机**（packet switch）：负责从 入通信链路 中接收到达的分组，并从一条 出通信链路 中转发该分组。
  - 常见的有路由器（roter）、链路层交换机（link-layer switch），他们都是用来向最终目的地转发分组。

> **路径**（path/route）:从最初的发送端到最终的接收端，一个分组所经历的一系列通信链路、分组交换机称为路径。类似现实中的交通网络，分组要到达目的地，需要选择计算机网络中的一条路径前行。

端系统通过因特网服务提供商（Internet Service Provider，ISP）接入因特网，他们会提供在机场、旅馆、公司等地可以接入的ISP。IPS也会将各种Web站点接入因特网。底层的ISP通过国家的高层ISP互联起来。  

![](../images/net/base-01.svg)   

### 1.3 协议

> **协议**（protocol）：用来定义两个、多个通信实体之间交换的报文格式、次序，以及在发送与接收时需要采取的动作

在现实生活中，我们与别人交流也是需要一定的步骤的，比如先打招呼，计算机也同样如此，下图展示了一个粗略的协议规范：  
![](../images/net/base-02.svg)   

端系统、分组交换机等都需要支持一系列协议，这些协议控制网络中的信息的接收和发送。因特网的主要协议统称为TCP/IP协议，这是2个协议：
- TCP（Transmission Control Protocol）：传输控制协议。
- IP（Internet Protocol）：网际协议，定义了路怄气和端系统之间发送、接收分组的格式。

因特网标准工程任务组（IETF）出台了相关标准文档，称为请求评论（Request For Comment，**RFC**），RFC文档定义了
TCP、IP、HTTP等协议标准，以及以太网、无限WiFi的标准。  

### 1.4 总结

```
端系统之间彼此要交换的数据称之为 报文（message）；
报文必须在源被划分为较小的数据块之后才能发送，即分组（packet）；
源与目的之间，每个分组通过通信链路、分组交换机传输；
```

## 二 网络边缘

端系统内运行着大量应用程序，这些应用程序位于网络的边缘，通过API接口向网络中发送数据。有时候，端系统也会被进一步划分为：**客户端(client)**、**服务端(server)**。   

**边缘路由器**（edge router）是端系统到任何其他远程端系统路径上的第一台路由器，即应用程序接入网络的第一步（access network）。  

接入互联网的方式有很多：
- 家庭接入：
  - DSL：从本地电话，利用家庭电话线接入本地电话公司处获得因特网接入。
  - 电缆：利用有线电视公司的有线电视设施接入。
  - 光纤：从本地中心局直接提供一条光纤路径连接到家庭
  - 拨号：与DSL相同，利用传统电话线接入，但是拨号速度极慢
  - 卫星：利用卫星链路接入
- 企业接入：一般利用局域网将端用户连接到边缘路由器
  - 以太网：使用双绞线和一台以太网交换机相连，以太网交换机再与更大的因特网相连

## 三 网络核心

### 3.0 数据传输的基本方法

网络链路和交换机移动数据的基本方法有两种：
- 分组交换（packet switching）
- 电路交换（circuit switching）

### 3.1 分组交换

#### 3.1.1 网络传输时间

如果源或分组交换机在某个链路上发送一个 L比特 的分组，链路传输速率为 R比特/秒，则传输事件为 L/R 秒：
```
网络传输时间 = L/R 秒 （L为分组大小：比特，R为传输速度 比特/秒）
```

#### 3.1.2 存储转发传输

> **存储转发传输机制**（store-and-forward transmission）：交换机必须先接收到整个分组后，才能向输出链路传输，即先缓存下来完成的分组，然后再转移到另一条链路。

通过由 N 条速度为 R 的链路组成的路径，端到端发送一个分组的时延是：  

$$ d_{端到端} = N\frac{L}{R}$$

#### 3.1.3 排队时延和分组丢失

每个分组交换机都连接了多条链路，分组交换机在每条链路上都具有一个 **输出缓存**(output buffer)，也称为 **输出队列**(output queue)，用于存储路由器准备发往该链路的分组。如果分组到达后，却发现该链路整忙于传输其他分组，新到达的分组就必须在缓存中等待，这就会造成 **排队时延**(queue delay)。  

排队时延是会变化的，取决于网络的拥塞程度。  

缓存的大小有限，若分组到达后，发现该缓存已经被其他等待传输的分组占满，则新到达的分组或者在排队的分组之一会被丢弃，这是 **分组丢失（丢包）**。  

拥塞示例：链路的速率是 1.5Mbps，分组的到达路由器的到达率（换算为每秒比特）超过了 1.5Mbps，就会在缓存中排队。

#### 3.1.4 转发表和路由选择协议

源主机在向目的端系统发送一个分组时，分组的头部会包含目的的IP地址，该分组若到达网络中的路由器，路由器会在内部的 **转发表**（forwarding table），找到合适的输出链路。很类似现实中的驾车路线选择。  

**路由选择协议**（routing protocol）是设置转发表的协议，如：决定从每台路由器到每个目的地的最短路径。

### 3.2 电路交换

在电路交换网络中，端系统如果开始会话，则会预留端系统间通信沿路径所需要的资源（缓存，链路传输速率），而分组交换网络中，这些资源不是预留的，也即会造成排队。   

传统的电话网络是电路交换网络的案例，双方在通信时，必须建立一条实际的连接，该路径上的交换机都需要维护连接状态。  

如图所示：  

![](../images/net/base-03.svg)  

在上图中，有4条链路连接着4台电路交换机，每条链路中包含3条电路，因此每条链路能支持3条并行的连接。如果一台电路交换机与另外一台电路交换机要发送报文，网络中必须在两条链路之一上预留一条电路，在链接七届，也就只能获得带宽的1/3部分。  

电路交换存在静默期（solent period），即类似打电话的一个人停止说话，则空闲的资源其他进行中的链接无法使用，从而造成了浪费。  

### 3.3 分组交换与电路交换对比

分组交换不适合实时服务：端到端的时延不可预测（因为排队时延不可预测）。  

但是分组交换能提供比电路交换更好的带宽共享，比电路交换简单有效，成本更低。  






