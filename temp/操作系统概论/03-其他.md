## 内存映射

调用系统函数 mmap()的进程，会在其虚拟地址空间中创建一个新的内存映射。  

映射分为两类：
- 文件映射：将文件的部分区域映射入调用进程的虚拟内存。映射一旦完成，对文件映射内容的访问则转化为对相应内存区域的字节操作。映射页面会按需自动从文件中加载
- 无文件与之相对应的匿名映射，其映射页面的内容会被初始化为 0。

由某一进程所映射的内存可以与其他进程的映射共享。达成共享的方式有二：其一是两个进程都针对某一文件的相同部分加以映射，其二是由 fork()创建的子进程自父进程处继承映射。当两个或多个进程共享的页面相同时，进程之一对页面内容的改动是否为其他进程所见呢？这取决于创建映射时所传入的标志参数。若传入标志为私有，则某进程对映射内容的修改对于其他进程是不可见的，而且这些改动也不会真地落实到文件上；若传入标志为共享，对映射内容的修改就会为其他进程所见，并且这些修改也会造成对文件的改动。内存映射用途很多，其中包括：以可执行文件的相应段来初始化进程的文本段、内存（内容填充为 0）分配、文件 I/O（即映射内存 I/O）以及进程间通信（通过共享映射）。  



## 进程间通信IPC

方式有：
- 信号（ signal），用来表示事件的发生。
- 管道（亦即 shell 用户所熟悉的“ |”操作符）和 FIFO，用于在进程间传递数据。
- 套接字，供同一台主机或是联网的不同主机上所运行的进程之间传递数据。
- 文件锁定，为防止其他进程读取或更新文件内容，允许某进程对文件的部分区域加以锁定。
- 消息队列，用于在进程间交换消息（数据包）。
- 信号量（ semaphore），用来同步进程动作。
- 共享内存，允许两个及两个以上进程共享一块内存。当某进程改变了共享内存的内容时，其他所有进程会立即了解到这一变化。

贴士：就本质而言， FIFO和 UNIX 套接字功能相同，允许同一系统上并无关联的进程彼此交换数据。二者之所以并存于现代 UNIX 系统之中，是由于 FIFO 来自 System V，而套接字则源于 BSD  

## 线程

每个进程都可执行多个线程。可将线程想象为共享同一虚拟内存及一干其他属性的进程。每个线程都会执行相同的程序代码，共享同一数据区域和堆。可是，
每个线程都拥有属于自己的栈，用来装载本地变量和函数调用链接信息。  

线程之间可通过共享的全局变量进行通信。借助于线程 API 所提供的条件变量和互斥机制，进程所属的线程之间得以相互通信并同步行为—尤其是在对共享变量的使用方面。此外，  利用 IPC 和同步机制，线程间也能彼此通信。  

线程的主要优点在于协同线程之间的数据共享（通过全局变量）更为容易，而且就某些算法而论，以多线程来实现比之以多进程实现要更加自然。再者，显而易见，多线程应用能从多处理器硬件的并行处理中获益匪浅。

## 进程组和 shell 任务控制

shell 执行的每个程序都会在一个新进程内发起。比如， shell 创建了 3 个进程来执行以下管道命令（在当前的工作目录下，根据文件大小对文件进行排序并显示）：

```
$ ls -l | sort -k5n | less
```

在支持任务控制的 shell 中，会将管道内的所有进程置于一个新进程组或任务中。（如果情况很简单， shell 命令行只包含一条命令，那么就会
创建一个只包含单个进程的新进程组。 ）进程组中的每个进程都具有相同的进程组标识符（以整数形式），其实就是进程组中某个进程（也称为进程组组长 process group leader）的进程 ID。  

内核可对进程组中的所有成员执行各种动作，尤其是信号的传递。

## 会话、控制终端和控制进程

会话指的是一组进程组（任务）。会话中的所有进程都具有相同的会话标识符。会话首进程（ session leader）是指创建会话的进程，其进程 ID 会成为会话 ID  

使用会话最多的是支持任务控制的 shell，由 shell 创建的所有进程组与 shell 自身隶属于同一会话， shell 是此会话的会话首进程。  

在任一时点，会话中总有一个前台进程组（前台任务），可以从终端中读取输入，向终端发送输出:  

如果用户在控制终端中输入了“中断”（通常是 Control-C）或“挂起”字符（通常是 Control-Z），那么终端驱动程序会发送信号以终止或挂起（亦即停止）前台进程组。  

一个会话可以拥有任意数量的后台进程组（后台任务），由以“ &”字符结尾的行命令来创建。支持任务控制的 shell 提供如下命令：列出所有任务，向任务发送信号，以及在前后台任务之间来回切换.  

伪终端：伪终端是一对相互连接的虚拟设备，也称为主从设备。在这对设备之间，设有一条 IPC信道，可供数据进行双向传递，比如市面上的ssh软件。  

## 进程与实践

- 真实时间：进程的生命周期时间  
- 进程时间：也称为CPU时间，指进程自启动起来，所占用cpu时间总量
  - 系统CPU时间：内核模式中，执行代码花费的时间，比如执行系统调用
  - 用户CPU时间：用户模式中，执行代码花费的时间，比如常规代码运行

time命令会显示出真实时间、系统CPU时间，以及执行管道中的多个进程花费的用户CPU时间。  


## 实时性

为支持实时性应用， POSIX.1b 定义了多个 POSIX.1 扩展，其中包括异步 I/O、共享内存、内存映射文件、内存锁定、实时性时钟和定时器、备选调度策略、实时性信号、消息队列、以及信号量等

## /proc文件系统

/proc 文件系统装配与 /proc 目录下。  

/proc 文件系统是一种虚拟文件系统，以文件系统目录和文件形式，提供一个指向内核数据结构的接口。  

这为查看和改变各种系统属性开启了方便之门。此外，还能通过一组以/proc/PID 形式命名的目录（ PID 即进程 ID）查看系统中运行各进程的相关信息。
通常， /proc 目录下的文件内容都采取人类可读的文本形式， shell 脚本也能对其进行解析。  

程序可以打开、读取和写入/proc 目录下的既定文件。大多数情况下，只有特权级进程才能修改/proc 目录下的文件内容。  


